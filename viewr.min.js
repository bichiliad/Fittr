/*! Viewr 2014-01-05 */
var Viewr=function(a,b){"use strict";if(!a)throw"You must provide a Flickr API key for Viewr to work.";var c=this;c.opts=b||{},c.key=a,c.opts.filter=c.opts.filter||null,c.opts.increment="increment"in c.opts?c.opts.increment:!0,c.opts.incRatio=c.opts.incRatio||2,c.opts.square="square"in c.opts?c.opts.square:!1;var d="http://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key="+c.key+"&format=json&nojsoncallback=1&photo_id=",e=[],f=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onreadystatechange=function(){4===c.readyState&&(200===c.status?b(JSON.parse(c.responseText)):(console.error(c),b(null,{status:c.status,statusText:c.statusText})))},c.send()};c.getImgsForID=function(a,b){f(d+a,b)},c.reload=function(){var a;a=c.opts.filter?document.querySelectorAll(c.opts.filter):document.getElementsByTagName("img");for(var d=0;d<a.length;d++){var f=a[d].getAttribute("data-flickr-id"),g=a[d].tagName.toLowerCase();if(f&&"img"==g){var h=a[d];c.getImgsForID(f,function(a,c){c&&console.error("Failed to retrieve image: "+f,c);var d=new ViewrImage(h,a,b);d.init(),e.push(d)})}}},c.reload()},ViewrImage=function(a,b,c){var d=this;d.opts=c||{};var e,f,a=a,g=b.sizes.size,h=d.opts.square||!1,i=window.devicePixelRatio||1,j=d.opts.increment||!0,k=d.opts.incRatio||2;d.width=(a.width||a.style.width)*i,d.init=function(){for(var b=0;b<g.length;b++)if(!(-1!==g[b].label.toLowerCase().indexOf("square")&&!h||-1==g[b].label.toLowerCase().indexOf("square")&&h)){if(e=g[b],e.width>=d.width)break;j&&!f&&e.width>=d.width/k&&(f=e,a.setAttribute("src",e.source))}j&&f?(a.onload=function(){a.setAttribute("src",e.source)},a.setAttribute("src",f.source)):a.setAttribute("src",e.source),a.style.visibility="visible"}};